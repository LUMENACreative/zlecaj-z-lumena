<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rejestracja Wykonawcy ‚Äî ZLECAJ z LUMENA</title>

  <!-- SEO -->
  <meta name="description" content="Za≈Ç√≥≈º konto wykonawcy i zdobywaj darmowe zlecenia na platformie ZLECAJ z LUMENA.">
  <meta name="author" content="LUMENA Creative" />
  <link rel="canonical" href="https://zlecajzlumena.pl/pages/rejestracja-firma.html" />

  <!-- Favicon -->
  <link rel="icon" href="/image/favicon.png" type="image/png">
  <meta name="theme-color" content="#0b0b0f" />

  <!-- Fonts & CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css" />
</head>

<body>
  <!-- HEADER -->
  <header class="topbar">
    <div class="wrap flex between center-v">
      <a href="/" class="logo">
        <img src="/image/zlecaj-z-lumena.png" alt="ZLECAJ z LUMENA logo" height="72" />
      </a>
      <nav class="nav">
        <a href="/">Strona g≈Ç√≥wna</a>
        <a href="/pages/zlecenia.html">Zlecenia</a>
        <a href="/pages/login.html" class="cta">Zaloguj siƒô</a>
      </nav>
    </div>
  </header>

  <!-- FORMULARZ REJESTRACJI FIRMY -->
  <main class="form-section">
    <div class="wrap">
      <h1>Rejestracja Wykonawcy</h1>
      <p class="subtitle">Za≈Ç√≥≈º darmowe konto i przeglƒÖdaj zlecenia w swojej bran≈ºy üíé</p>

      <form id="formFirma" class="zlecenie-form">
        <div class="form-group grid-2">
          <div>
            <label for="nazwa">Nazwa firmy *</label>
            <input type="text" id="nazwa" name="nazwa" placeholder="np. Golden Build" required>
          </div>
          <div>
            <label for="email">E-mail *</label>
            <input type="email" id="email" name="email" placeholder="np. kontakt@..." required>
          </div>
        </div>

        <div class="form-group grid-2">
          <div>
            <label for="telefon">Telefon *</label>
            <input type="tel" id="telefon" name="telefon" placeholder="np. 600 123 456" required>
          </div>
          <div>
            <label for="haslo">Has≈Ço *</label>
            <input type="password" id="haslo" name="haslo" placeholder="Min. 6 znak√≥w" required minlength="6">
          </div>
        </div>

        <div class="form-group">
          <label for="branza">Bran≈ºa *</label>
          <select id="branza" name="branza" required>
            <option value="">Wybierz kategoriƒô</option>
            <option>Remonty i budowa</option>
            <option>Wyko≈Ñczenia wnƒôtrz</option>
            <option>Ogr√≥d i zewnƒôtrza</option>
            <option>Us≈Çugi projektowe</option>
            <option>Transport i przeprowadzki</option>
            <option>Inne</option>
          </select>
        </div>

        <div class="form-group">
          <label for="opis">Opis firmy (opcjonalnie)</label>
          <textarea id="opis" name="opis" rows="4" placeholder="Opisz czym siƒô zajmujesz, do≈õwiadczenie, realizacje..."></textarea>
        </div>

        <div class="form-group checkbox">
          <label>
            <input type="checkbox" required>
            Akceptujƒô <a href="/pages/polityka.html" target="_blank">politykƒô prywatno≈õci</a>.
          </label>
        </div>

        <div class="form-actions center">
          <button type="submit" class="cta secondary">Utw√≥rz konto wykonawcy</button>
        </div>
      </form>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="lumena-footer" style="margin-top:100px;">
    <div class="copy">
      ¬© 2025 <span class="gold">LUMENA Creative</span> üíé  
      <br><small>Wszystkie prawa zastrze≈ºone.</small>
    </div>
  </footer>

  <!-- üî• FIREBASE ‚Äî REJESTRACJA FIRMY -->
  <script type="module">
    import { auth, db } from "/js/firebase.js";
    import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
    import { doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    const form = document.getElementById("formFirma");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const nazwa = document.getElementById("nazwa").value.trim();
      const email = document.getElementById("email").value.trim();
      const telefon = document.getElementById("telefon").value.trim();
      const haslo = document.getElementById("haslo").value.trim();
      const branza = document.getElementById("branza").value.trim();
      const opis = document.getElementById("opis").value.trim();

      if (!nazwa || !email || !telefon || !haslo || !branza) {
        alert("Uzupe≈Çnij wszystkie wymagane pola.");
        return;
      }

      try {
        // Rejestracja w Firebase Authentication
        const userCredential = await createUserWithEmailAndPassword(auth, email, haslo);
        const user = userCredential.user;

        // Zapis danych firmy w Firestore
        await setDoc(doc(db, "firmy", user.uid), {
          typ: "company",
          nazwa,
          email,
          telefon,
          branza,
          opis,
          createdAt: serverTimestamp()
        });

        // LocalStorage ‚Äî automatyczne logowanie
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("userEmail", email);
        localStorage.setItem("userType", "company");

        alert("‚úÖ Konto wykonawcy zosta≈Ço utworzone pomy≈õlnie!");
        window.location.href = "/pages/panel-firma.html";

      } catch (error) {
        console.error("‚ùå B≈ÇƒÖd rejestracji:", error);
        if (error.code === "auth/email-already-in-use") {
          alert("Ten adres e-mail jest ju≈º zarejestrowany.");
        } else {
          alert("B≈ÇƒÖd: " + error.message);
        }
      }
    });
  </script>

  <script src="/js/access-control.js"></script>
</body>
</html>
